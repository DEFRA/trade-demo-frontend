{% extends "layouts/page.njk" %}

{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/inset-text/macro.njk" import govukInsetText %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}

{% block content %}
  <h1 class="govuk-heading-xl">{{ heading }}</h1>

  {% if errorMessage %}
    {{ govukErrorSummary({
      titleText: "There is a problem",
      errorList: [
        {
          text: errorMessage
        }
      ]
    }) }}
  {% endif %}

  {# Search Form #}
  <form method="GET" action="/examples" novalidate>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        {{ govukInput({
          label: {
            text: "Search by name"
          },
          id: "search",
          name: "search",
          value: searchQuery,
          classes: "govuk-!-width-two-thirds"
        }) }}
      </div>
    </div>

    <div class="govuk-button-group">
      {{ govukButton({
        text: "Search"
      }) }}
      {% if searchQuery %}
        <a href="/examples" class="govuk-link">Clear search</a>
      {% endif %}
    </div>
  </form>

  {# Create Button #}
  <div class="govuk-!-margin-top-6">
    {{ govukButton({
      text: "Create new example",
      href: "/example/create/name",
      classes: "govuk-button--secondary"
    }) }}
  </div>

  {# Results #}
  {% if not errorMessage %}
    {% if hasResults %}
      <p class="govuk-body">
        Showing {{ examples.length }}
        {% if searchQuery %}of {{ totalCount }}{% endif %}
        example{{ 's' if examples.length != 1 }}
      </p>

      {% set tableRows = [] %}
      {% for example in examples %}
        {% set tableRows = (tableRows.push([
          { text: example.name },
          { text: example.value },
          { text: example.counter if example.counter else 'â€”' },
          { html: '<a class="govuk-link" href="/example/' + example.id + '">View</a> | <a class="govuk-link" href="/example/' + example.id + '/edit">Edit</a> | <a class="govuk-link" href="/example/' + example.id + '/delete">Delete</a>' }
        ]), tableRows) %}
      {% endfor %}

      {{ govukTable({
        head: [
          { text: "Name" },
          { text: "Value" },
          { text: "Counter" },
          { text: "Actions" }
        ],
        rows: tableRows
      }) }}
    {% else %}
      {{ govukInsetText({
        text: "No examples found" + (" matching '" + searchQuery + "'" if searchQuery else "")
      }) }}
    {% endif %}
  {% endif %}
{% endblock %}
